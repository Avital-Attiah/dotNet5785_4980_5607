<Window x:Class="PL.Volunteer.VolunteerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PL"
        Title="פרטי מתנדב"
        Height="700" Width="400"
        Background="#E8F6FF"
        WindowStartupLocation="CenterScreen"
        DataContext="{Binding Volunteer, RelativeSource={RelativeSource Self}}">

    <Window.Resources>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverterKey"/>
        <local:SingleToCollectionConverter x:Key="SingleToCollectionConverterKey"/>
    </Window.Resources>

    <Border CornerRadius="15" BorderBrush="#007ACC" BorderThickness="2"
            Background="White" Padding="20" Margin="20">
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- ID -->
                <RowDefinition Height="Auto"/>
                <!-- FullName -->
                <RowDefinition Height="Auto"/>
                <!-- Phone -->
                <RowDefinition Height="Auto"/>
                <!-- Email -->
                <RowDefinition Height="Auto"/>
                <!-- Address -->
                <RowDefinition Height="Auto"/>
                <!-- Role -->
                <RowDefinition Height="Auto"/>
                <!-- IsActive -->
                <RowDefinition Height="Auto"/>
                <!-- MaxCallDistance -->
                <RowDefinition Height="Auto"/>
                <!-- DistanceType -->
                <RowDefinition Height="Auto"/>
                <!-- Password -->
                <RowDefinition Height="Auto"/>
                <!-- Current Call Label -->
                <RowDefinition Height="Auto"/>
                <!-- Current Call Details -->
                <RowDefinition Height="Auto"/>
                <!-- Update Button -->
                <RowDefinition Height="Auto"/>
                <!-- Finish Treatment Button -->
                <RowDefinition Height="Auto"/>
                <!-- Cancel Treatment Button -->
            </Grid.RowDefinitions>

            <!-- ID -->
            <Label Grid.Row="0" Grid.Column="0" Content="ID:" Margin="0,5"/>
            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Volunteer.Id}" IsEnabled="{Binding IsIdEnabled}" Margin="5"/>

            <!-- FullName -->
            <Label Grid.Row="1" Grid.Column="0" Content="Full Name:" Margin="0,5"/>
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Volunteer.FullName, Mode=TwoWay}" Margin="5"/>

            <!-- Phone -->
            <Label Grid.Row="2" Grid.Column="0" Content="Phone:" Margin="0,5"/>
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Volunteer.Phone, Mode=TwoWay}" Margin="5"/>

            <!-- Email -->
            <Label Grid.Row="3" Grid.Column="0" Content="Email:" Margin="0,5"/>
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Volunteer.Email, Mode=TwoWay}" Margin="5"/>

            <!-- Address -->
            <Label Grid.Row="4" Grid.Column="0" Content="Address:" Margin="0,5"/>
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding Volunteer.Address, Mode=TwoWay}" Margin="5"/>

            <!-- Role -->
            <Label Grid.Row="5" Grid.Column="0" Content="Role:" Margin="0,5"/>
            <ComboBox Grid.Row="5" Grid.Column="1"
                      ItemsSource="{StaticResource RolesCollectionKey}"
                      SelectedItem="{Binding Volunteer.Role, Mode=TwoWay}"
                      IsEnabled="{Binding IsRoleEditable}"
                      Margin="5"/>

            <!-- IsActive -->
            <Label Grid.Row="6" Grid.Column="0" Content="פעיל:" Margin="0,5"/>
            <CheckBox Grid.Row="6" Grid.Column="1"
                      IsChecked="{Binding Volunteer.IsActive, UpdateSourceTrigger=PropertyChanged}"
                      IsEnabled="{Binding Path=CanDeactivate, Mode=OneWay}"
                      Margin="5"/>

            <!-- MaxCallDistance -->
            <Label Grid.Row="7" Grid.Column="0" Content="Max Call Distance:" Margin="0,5"/>
            <TextBox Grid.Row="7" Grid.Column="1"
                     Text="{Binding Volunteer.MaxCallDistance, Mode=TwoWay}"
                     Margin="5"/>

            <!-- DistanceType -->
            <Label Grid.Row="8" Grid.Column="0" Content="Distance Type:" Margin="0,5"/>
            <ComboBox Grid.Row="8" Grid.Column="1"
                      ItemsSource="{StaticResource DistanceTypesCollectionKey}"
                      SelectedItem="{Binding Volunteer.DistanceType, Mode=TwoWay}"
                      Margin="5"/>

            <!-- Password -->
            <Label Grid.Row="9" Grid.Column="0" Content="Password:" Margin="0,5"/>
            <TextBox Grid.Row="9" Grid.Column="1"
                     Text="{Binding Volunteer.Password, Mode=TwoWay}"
                     Margin="5"/>

            <!-- Current Call Label -->
            <TextBlock Grid.Row="10" Grid.ColumnSpan="2"
                       Text="קריאה בטיפול נוכחי"
                       FontSize="16" FontWeight="Bold"
                       Foreground="#007ACC"
                       Margin="0,10,0,5"
                       Visibility="{Binding Volunteer.CurrentCall, Converter={StaticResource NullToVisibilityConverterKey}}"/>

            <!-- Current Call Details -->
            <ItemsControl Grid.Row="11" Grid.ColumnSpan="2"
                          ItemsSource="{Binding Volunteer.CurrentCall, Converter={StaticResource SingleToCollectionConverterKey}}"
                          Margin="0,0,0,10">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="5,0,0,0">
                            <TextBlock Text="{Binding CurrentCall, StringFormat=סטטוסקריאה: {0}}" />
                            <TextBlock Text="{Binding Description, StringFormat=תיאור: {0}}"/>
                            <TextBlock Text="{Binding Status, StringFormat=סטטוס: {0}}"/>
                            <TextBlock Text="{Binding OpeningTime, StringFormat=נפתחה: {0:dd/MM/yyyy HH:mm}}"/>
                            <!-- Distance TextBlock מתוקן -->
                            <TextBlock>
                                <Run Text="מרחק מהמתנדב: "/>
                                <Run Text="{Binding DistanceFromVolunteer}"/>
                                <Run Text=" ק״מ"/>
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Update Button -->
            <Button Grid.Row="12" Grid.ColumnSpan="2"
                    Content="{Binding ButtonText}"
                    Click="btnAddUpdate_Click"
                    Width="100"
                    Height="35"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,0"
                    Style="{StaticResource MainButtonStyle}"/>

            <!-- Finish Treatment Button -->
            <Button Grid.Row="13" Grid.ColumnSpan="2"
                    Content="סיום טיפול"
                    Click="btnCompleteCall_Click"
                    Width="120"
                    Height="35"
                    HorizontalAlignment="Center"
                    Margin="0,5,0,0"
                    Visibility="{Binding Volunteer.CurrentCall, Converter={StaticResource NullToVisibilityConverterKey}, ConverterParameter=Inverse}"/>

            <!-- Cancel Treatment Button -->
            <Button Grid.Row="14" Grid.ColumnSpan="2"
                    Content="ביטול טיפול"
                    Click="btnCancelCall_Click"
                    Width="120"
                    Height="35"
                    HorizontalAlignment="Center"
                    Margin="0,5,0,0"
                    Visibility="{Binding Volunteer.CurrentCall, Converter={StaticResource NullToVisibilityConverterKey}, ConverterParameter=Inverse}"/>

        </Grid>
    </Border>
</Window>
